<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 User Interfaces for Health Economic Evaluation | Data Science for Public Health Economic Evaluation</title>
  <meta name="description" content="This is a teaching tool in progress" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 User Interfaces for Health Economic Evaluation | Data Science for Public Health Economic Evaluation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a teaching tool in progress" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 User Interfaces for Health Economic Evaluation | Data Science for Public Health Economic Evaluation" />
  
  <meta name="twitter:description" content="This is a teaching tool in progress" />
  

<meta name="author" content="Robert Smith" />


<meta name="date" content="2020-05-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="microsimulation-model.html"/>
<link rel="next" href="collaboration-in-github.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Background</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.1</b> Who are we:</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#our-series-of-short-courses-in-r."><i class="fa fa-check"></i><b>1.2</b> Our series of Short Courses in R.</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#course-1---intro-to-r"><i class="fa fa-check"></i><b>1.2.1</b> Course 1 - Intro to R</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#course-2---intermediate-r"><i class="fa fa-check"></i><b>1.2.2</b> Course 2 - Intermediate R</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#course-3---beautiful-visualisations"><i class="fa fa-check"></i><b>1.2.3</b> Course 3 - Beautiful Visualisations</a></li>
<li class="chapter" data-level="1.2.4" data-path="index.html"><a href="index.html#course-4---r-for-health-economics"><i class="fa fa-check"></i><b>1.2.4</b> Course 4 - R for Health Economics</a></li>
<li class="chapter" data-level="1.2.5" data-path="index.html"><a href="index.html#course-5---r-shiny-for-decision-modelling"><i class="fa fa-check"></i><b>1.2.5</b> Course 5 - R Shiny for decision modelling</a></li>
<li class="chapter" data-level="1.2.6" data-path="index.html"><a href="index.html#course-6---collaboration-in-r"><i class="fa fa-check"></i><b>1.2.6</b> Course 6 - Collaboration in R</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#aim-of-the-series-of-courses"><i class="fa fa-check"></i><b>1.3</b> Aim of the series of courses</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#install-and-navigate-r-studio."><i class="fa fa-check"></i><b>2.1</b> Install and navigate R Studio.</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#basics"><i class="fa fa-check"></i><b>2.2</b> Basics</a><ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#basic-operations"><i class="fa fa-check"></i><b>2.2.1</b> Basic operations</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#objects"><i class="fa fa-check"></i><b>2.2.2</b> Objects</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#overwriting-manipulating-objects"><i class="fa fa-check"></i><b>2.2.3</b> Overwriting / Manipulating Objects</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#seeing-our-objects"><i class="fa fa-check"></i><b>2.2.4</b> Seeing our Objects</a></li>
<li class="chapter" data-level="2.2.5" data-path="intro.html"><a href="intro.html#removing-objects"><i class="fa fa-check"></i><b>2.2.5</b> Removing Objects</a></li>
<li class="chapter" data-level="2.2.6" data-path="intro.html"><a href="intro.html#evaluations"><i class="fa fa-check"></i><b>2.2.6</b> Evaluations</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#object-classes-and-types"><i class="fa fa-check"></i><b>2.3</b> Object classes and types</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#object-classes"><i class="fa fa-check"></i><b>2.3.1</b> Object Classes</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro.html"><a href="intro.html#operations-on-different-data-structures"><i class="fa fa-check"></i><b>2.3.2</b> Operations on different data structures</a></li>
<li class="chapter" data-level="2.3.3" data-path="intro.html"><a href="intro.html#basic-object-types"><i class="fa fa-check"></i><b>2.3.3</b> Basic object Types</a></li>
<li class="chapter" data-level="2.3.4" data-path="intro.html"><a href="intro.html#subsetting"><i class="fa fa-check"></i><b>2.3.4</b> Subsetting</a></li>
<li class="chapter" data-level="2.3.5" data-path="intro.html"><a href="intro.html#independent-exercises"><i class="fa fa-check"></i><b>2.3.5</b> Independent Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#working-with-data-in-r"><i class="fa fa-check"></i><b>2.4</b> Working with Data in R</a><ul>
<li class="chapter" data-level="2.4.1" data-path="intro.html"><a href="intro.html#keeping-track-of-progress-in-r"><i class="fa fa-check"></i><b>2.4.1</b> Keeping Track of progress in R</a></li>
<li class="chapter" data-level="2.4.2" data-path="intro.html"><a href="intro.html#importing-data"><i class="fa fa-check"></i><b>2.4.2</b> Importing Data</a></li>
<li class="chapter" data-level="2.4.3" data-path="intro.html"><a href="intro.html#summarising-data"><i class="fa fa-check"></i><b>2.4.3</b> Summarising Data</a></li>
<li class="chapter" data-level="2.4.4" data-path="intro.html"><a href="intro.html#plotting-data"><i class="fa fa-check"></i><b>2.4.4</b> Plotting Data</a></li>
<li class="chapter" data-level="2.4.5" data-path="intro.html"><a href="intro.html#troubleshooting-in-r"><i class="fa fa-check"></i><b>2.4.5</b> Troubleshooting in R</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#further-learning"><i class="fa fa-check"></i><b>2.5</b> Further learning</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intermediate-r.html"><a href="intermediate-r.html"><i class="fa fa-check"></i><b>3</b> Intermediate R</a></li>
<li class="chapter" data-level="4" data-path="beautiful-visualizations-in-r.html"><a href="beautiful-visualizations-in-r.html"><i class="fa fa-check"></i><b>4</b> Beautiful Visualizations in R</a></li>
<li class="chapter" data-level="5" data-path="markov-models.html"><a href="markov-models.html"><i class="fa fa-check"></i><b>5</b> Markov Models</a></li>
<li class="chapter" data-level="6" data-path="microsimulation-model.html"><a href="microsimulation-model.html"><i class="fa fa-check"></i><b>6</b> Microsimulation Model</a></li>
<li class="chapter" data-level="7" data-path="user-interfaces-for-health-economic-evaluation.html"><a href="user-interfaces-for-health-economic-evaluation.html"><i class="fa fa-check"></i><b>7</b> User Interfaces for Health Economic Evaluation</a><ul>
<li class="chapter" data-level="7.1" data-path="user-interfaces-for-health-economic-evaluation.html"><a href="user-interfaces-for-health-economic-evaluation.html#abstract"><i class="fa fa-check"></i><b>7.1</b> Abstract</a></li>
<li class="chapter" data-level="7.2" data-path="user-interfaces-for-health-economic-evaluation.html"><a href="user-interfaces-for-health-economic-evaluation.html#introduction"><i class="fa fa-check"></i><b>7.2</b> Introduction</a></li>
<li class="chapter" data-level="7.3" data-path="user-interfaces-for-health-economic-evaluation.html"><a href="user-interfaces-for-health-economic-evaluation.html#methods"><i class="fa fa-check"></i><b>7.3</b> Methods</a><ul>
<li class="chapter" data-level="7.3.1" data-path="user-interfaces-for-health-economic-evaluation.html"><a href="user-interfaces-for-health-economic-evaluation.html#functions"><i class="fa fa-check"></i><b>7.3.1</b> Functions</a></li>
<li class="chapter" data-level="7.3.2" data-path="user-interfaces-for-health-economic-evaluation.html"><a href="user-interfaces-for-health-economic-evaluation.html#creating-the-model-wrapper"><i class="fa fa-check"></i><b>7.3.2</b> Creating the model wrapper</a></li>
<li class="chapter" data-level="7.3.3" data-path="user-interfaces-for-health-economic-evaluation.html"><a href="user-interfaces-for-health-economic-evaluation.html#integrating-into-r-shiny"><i class="fa fa-check"></i><b>7.3.3</b> Integrating into R-Shiny</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="user-interfaces-for-health-economic-evaluation.html"><a href="user-interfaces-for-health-economic-evaluation.html#discussion"><i class="fa fa-check"></i><b>7.4</b> Discussion</a></li>
<li class="chapter" data-level="7.5" data-path="user-interfaces-for-health-economic-evaluation.html"><a href="user-interfaces-for-health-economic-evaluation.html#conclusion"><i class="fa fa-check"></i><b>7.5</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html"><i class="fa fa-check"></i><b>8</b> Collaboration in GitHub</a><ul>
<li class="chapter" data-level="8.0.1" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#git"><i class="fa fa-check"></i><b>8.0.1</b> Git</a></li>
<li class="chapter" data-level="8.0.2" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#setting-up-rstudio"><i class="fa fa-check"></i><b>8.0.2</b> Setting up RStudio</a></li>
<li class="chapter" data-level="8.1" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#creating-a-project-with-git-integration"><i class="fa fa-check"></i><b>8.1</b> Creating a Project with Git Integration</a></li>
<li class="chapter" data-level="8.2" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#adding-a-new-file-to-the-project"><i class="fa fa-check"></i><b>8.2</b> Adding a New File to the Project</a></li>
<li class="chapter" data-level="8.3" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#overview-of-the-git-panel"><i class="fa fa-check"></i><b>8.3</b> Overview of the Git Panel</a><ul>
<li class="chapter" data-level="8.3.1" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#empty-repositories"><i class="fa fa-check"></i><b>8.3.1</b> Empty Repositories</a></li>
<li class="chapter" data-level="8.3.2" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#adding-files-to-git"><i class="fa fa-check"></i><b>8.3.2</b> Adding Files to Git</a></li>
<li class="chapter" data-level="8.3.3" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#committing-the-change"><i class="fa fa-check"></i><b>8.3.3</b> Committing the Change</a></li>
<li class="chapter" data-level="8.3.4" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#looking-at-previous-revisions"><i class="fa fa-check"></i><b>8.3.4</b> Looking at Previous Revisions</a></li>
<li class="chapter" data-level="8.3.5" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#git-for-single-users"><i class="fa fa-check"></i><b>8.3.5</b> Git for Single Users</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#collaborating-with-git"><i class="fa fa-check"></i><b>8.4</b> Collaborating with Git</a><ul>
<li class="chapter" data-level="8.4.1" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#cloning-a-repository"><i class="fa fa-check"></i><b>8.4.1</b> Cloning a Repository</a></li>
<li class="chapter" data-level="8.4.2" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#pushing-to-a-repository"><i class="fa fa-check"></i><b>8.4.2</b> Pushing to a Repository</a></li>
<li class="chapter" data-level="8.4.3" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#github-and-bitbucket"><i class="fa fa-check"></i><b>8.4.3</b> GitHub and BitBucket</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#cloning-a-github-project"><i class="fa fa-check"></i><b>8.5</b> Cloning a GitHub Project</a><ul>
<li class="chapter" data-level="8.5.1" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#getting-a-github-account"><i class="fa fa-check"></i><b>8.5.1</b> Getting a GitHub Account</a></li>
<li class="chapter" data-level="8.5.2" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#forking-the-repository"><i class="fa fa-check"></i><b>8.5.2</b> Forking the Repository</a></li>
<li class="chapter" data-level="8.5.3" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#cloning-the-repository-with-rstudio"><i class="fa fa-check"></i><b>8.5.3</b> Cloning the Repository with RStudio</a></li>
<li class="chapter" data-level="8.5.4" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#making-changes"><i class="fa fa-check"></i><b>8.5.4</b> Making changes</a></li>
<li class="chapter" data-level="8.5.5" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#add-a-new-r-file-optional"><i class="fa fa-check"></i><b>8.5.5</b> Add a New R File (Optional)</a></li>
<li class="chapter" data-level="8.5.6" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#pushing-your-changes"><i class="fa fa-check"></i><b>8.5.6</b> Pushing Your Changes</a></li>
<li class="chapter" data-level="8.5.7" data-path="collaboration-in-github.html"><a href="collaboration-in-github.html#making-a-pull-request"><i class="fa fa-check"></i><b>8.5.7</b> Making a Pull Request</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science for Public Health Economic Evaluation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="user-interfaces-for-health-economic-evaluation" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> User Interfaces for Health Economic Evaluation</h1>
<p>Robert Smith<sup>1</sup> &amp; Paul Schneider<sup>1</sup></p>

<p><em><sup>1</sup>ScHARR, University of Sheffield</em></p>
<p><em>Corresponding Author: Robert Smith - <a href="mailto:rasmith3@sheffield.ac.uk" class="email">rasmith3@sheffield.ac.uk</a></em>
</p>
<div id="abstract" class="section level2">
<h2><span class="header-section-number">7.1</span> Abstract</h2>
<p>Health economic evaluation models have traditionally been built in Microsoft Excel, but more sophisticated tools are increasingly being used as model complexity and computational requirements increase. Of all the programming languages, R is most popular amongst health economists because it has a plethora of user-created packages and is highly flexible. However, even with an integrated development environments (e.g. R-Studio), R lacks a simple point-and-click user interface and therefore requires some programming ability. This might make the switch from Microsoft Excel to R seem daunting, and it might make it difficult to directly communicate results with decisions makers and other stakeholders.</p>
<p>The R package Shiny has the potential to resolve this limitation. It allows programmers to embed health economic models developed in R into interactive web-browser-based user interfaces. Users can specify their own assumptions about model parameters and run different scenario analyses, which, in case of regular a Markov model, can be computed within seconds. This paper provides a tutorial on how to wrap a health economic model built in R into a Shiny application. We use a 4 state Markov model developed by the Decision Analysis in R for Technologies in Health <span class="citation">(Workgroup <a href="#ref-DARTH" role="doc-biblioref">2020</a>)</span> group as a case-study to demonstrate main principles and basic functionality.</p>
<p>A more extensive tutorial, all code, and data are provided in a GitHub repository: <a href="https://robertasmith.github.io/healthecon_shiny/">https://robertasmith.github.io/healthecon_shiny/</a>.</p>
</div>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">7.2</span> Introduction</h2>
<p>As the complexity of health economic models increase, there is growing recognition of the advantages of using high level programming languages to support statistical analysis (e.g. R, Python, C++, Julia). Depending on the model that is being used, Microsoft Excel can be relatively slow. Certain types of models (e.g. individual-level simulations) can take a very long time to run or become computationally infeasible, and some essential statistical methods can hardly be implemented at all (e.g. survival modelling, network meta analysis, value of sample information), and rely on exporting results from other programs (e.g. R, STATA, WinBUGs).</p>
<p>Of all the high level programming languages, R is the most popular amongst health economists <span class="citation">(Jalal et al. <a href="#ref-jalal2017overview" role="doc-biblioref">2017</a>)</span>. R is open source, supported by a large community of statisticians, data scientists and health economists. There are extensive collections of (mostly free) online resources, including packages, tutorials, courses, and guidelines. Chunks of code, model functions, and entire models are shared by numerous authors, which allow R users to quickly adopt and adapt methods and code created by others. Importantly for the UK, R is also currently the only programming environment accepted by NICE for HTA submissions, the alternative submission formats Excel, DATA/TreeAge, and WinBUGS are all software applications <span class="citation">(Health and Britain) <a href="#ref-national2014guide" role="doc-biblioref">2014</a>)</span>.</p>
<p>Despite the many strengths of the script-based approach (e.g R) to decision modelling, an important limitation has been the lack of an easy-to-understand user-interface which would be useful as it “facilitates the development and communication of the model structure” <span class="citation">(Jalal et al. <a href="#ref-jalal2017overview" role="doc-biblioref">2017</a>, 743)</span>. While it is common practice for ‘spreadsheet models’ to have a structured front tab, which allows decision makers to manipulate model assumptions and change parameters to assess their impact on the results, up until recently, R models had to be adapted within script files or command lines.</p>
<p>Released in 2012, Shiny is an R-package which can be used to create a graphical, web browser based interface. The result looks like a website, and allows users to interact with underlying R models, without the need to manipulate the source code <span class="citation">(Beeley <a href="#ref-beeley2016web" role="doc-biblioref">2016</a>)</span>.
Shiny has already been widely adopted in many different areas and by various organisations, to present the results of statistical analysis <span class="citation">(Gendron <a href="#ref-gendron2016introduction" role="doc-biblioref">2016</a>)</span>. With health economics Shiny is currently being used to conduct network meta analysis <span class="citation">(Owen et al. <a href="#ref-owen2019metainsight" role="doc-biblioref">2019</a>)</span> and value of information analysis (<span class="citation">Strong, Oakley, and Brennan (<a href="#ref-strong2014estimating" role="doc-biblioref">2014</a>)</span>; <span class="citation">Baio, Berardi, and Heath (<a href="#ref-baio2017bceaweb" role="doc-biblioref">2017</a>)</span>).</p>
<p>Using Shiny, it is possible to create flexible user interfaces which allow users to specify different assumptions, change parameters, run underlying R code and visualise results. The primary benefit of this is that it makes script based computer models accessible to those with no programming knowledge - opening models up to critical inquiry from decision makers and other stakerholders <span class="citation">(Jansen, Incerti, and Linthicum <a href="#ref-jansen2019developing" role="doc-biblioref">2019</a>)</span>. Other benefits come from leveraging the power of R’s many publicly available packages, for example allowing for publication quality graphs and tables to be downloaded, user specific data-files uploaded and open-access data automatically updated. Shiny web applications for R health economic models seem particularly useful in cases where model parameters are highly uncertain or unknown, and where analysis may want to be conducted with hetrogeneous assumptions (e.g. for different populations). Once an R model and a Shiny application have been created, they can also be easily adapted, making it possible to quickly update the model when new information becomes available.</p>
<p>While, from a transparency perspective, it is preferable that models constructed in R are made open-access to improve replicability and collaboration, it is not a requirement <span class="citation">(Hatswell and Chandler <a href="#ref-hatswell2017sharing" role="doc-biblioref">2017</a>)</span>. Sensitive and proprietary data and/or models can be shared internally, or through password-protected web applications, negating the need to email zipped folders.</p>
<p>Several authors have postulated that there is considerable potential in using Shiny to support and improve health economic decision making. <span class="citation">Incerti et al. (<a href="#ref-incerti2019r" role="doc-biblioref">2019</a>)</span> identified web applications as being an essential part of modelling, stating that they “believe that the future of cost-effectiveness modeling lies in web apps, in which graphical interfaces are used to run script-based models” (p. 577). Similarly, <span class="citation">Baio and Heath (<a href="#ref-baio2017simple" role="doc-biblioref">2017</a>)</span> predicted that R Shiny web apps will be the “future of applied statistical modelling, particularly for cost-effectiveness analysis” (p.e5). Despite these optimistic prognoses, adoption of R in health economics has been slow and the use of Shiny seems to have been limited to only a few cases. A reason for this might be the lack of accessible tutorials, tailored towards an economic modeller audience.</p>
<p>Here, we provide a simple example of a Shiny web app, using a general 4-state Markov model. The model is based on the ‘Sick-Sicker model’, which has been described in detail in previous publications (<span class="citation">Alarid-Escudero et al. (<a href="#ref-alarid2019need" role="doc-biblioref">2019</a>)</span>; <span class="citation">Alarid-Escudero et al. (<a href="#ref-alarid2020cohort" role="doc-biblioref">2020</a>)</span>) and in open source teaching materials by the DARTH workgroup <span class="citation">(Workgroup <a href="#ref-DARTH" role="doc-biblioref">2020</a>)</span>. The model was slightly adapted to implement probabilistic sensitivity analysis.</p>
</div>
<div id="methods" class="section level2">
<h2><span class="header-section-number">7.3</span> Methods</h2>
<p>While the focus of this tutorial is on the application of Shiny for health economic models, below we provide a brief overview of the “Sick-Sicker model”. For further details, readers are encouraged to consult <span class="citation">Alarid-Escudero et al. (<a href="#ref-alarid2019need" role="doc-biblioref">2019</a>)</span>, <span class="citation">Alarid-Escudero et al. (<a href="#ref-alarid2020cohort" role="doc-biblioref">2020</a>)</span>, <span class="citation">Krijkamp et al. (<a href="#ref-krijkamp2018microsimulation" role="doc-biblioref">2018</a>)</span> and the DARTH group website <span class="citation">(Workgroup <a href="#ref-DARTH" role="doc-biblioref">2020</a>)</span>.</p>
<p>The Sick-Sicker model is a 4 state (Healthy, Sick, Sicker or Dead) Markov model. The cohort progresses through the model in cycles of equal duration, with the proportion of those in each health state in the next cycle being dependant on the proportion in each health state in the current cycle and a constant transition probability matrix.</p>
<p>The analysis incorporates probabilistic sensitivity analysis (PSA) by creating a data-frame of PSA inputs (one row being one set of model inputs) based on cost, utility and probability distributions using the function <em>f_gen_psa</em> and then running the model with each set of PSA inputs using the model function <em>f_MM_sicksicker</em>. We therefore begin by describing the two functions <em>f_gen_psa</em> and <em>f_MM_sicksicker</em> in more detail before moving on to demonstrate how to create a user-interface. Note that we add to the coding framework from Alarid-Escudero et al., (2019) to use the <em>f_</em> prefix for functions.</p>
<div id="functions" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Functions</h3>
<div id="creating-psa-inputs." class="section level4">
<h4><span class="header-section-number">7.3.1.1</span> Creating PSA inputs.</h4>
<p>The f_gen_psa function returns a data-frame of probabilistic sensitivity analysis inputs: transition probabilities between health states using a beta distribution, hazard rates using a log-normal distribution, costs using a gamma distribution and utilities using a truncnormal distribution. It relies on two inputs, the number of simulations (PSA inputs), and the cost (which takes a fixed value). We set the defaults to 1000 and 50 respectively.</p>
<p>NOTE: in order to use the <em>rtruncnorm</em> function the user must first install and load the ‘truncnorm’ package using <em>install.packages</em> and <em>library()</em>.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-1"></a>f_gen_psa &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n_sim =</span> <span class="dv">1000</span>, <span class="dt">c_Trt =</span> <span class="dv">50</span>){</span>
<span id="cb112-2"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-2"></a>   </span>
<span id="cb112-3"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-3"></a>  df_psa &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb112-4"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-4"></a>    </span>
<span id="cb112-5"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-5"></a>    <span class="co"># Transition probabilities (per cycle)</span></span>
<span id="cb112-6"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-6"></a>    <span class="dt">p_HS1   =</span> <span class="kw">rbeta</span>(n_sim, <span class="dv">30</span>, <span class="dv">170</span>),        <span class="co"># prob Healthy -&gt; Sick</span></span>
<span id="cb112-7"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-7"></a>    <span class="dt">p_S1H   =</span> <span class="kw">rbeta</span>(n_sim, <span class="dv">60</span>, <span class="dv">60</span>) ,        <span class="co"># prob Sick    -&gt; Healthy</span></span>
<span id="cb112-8"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-8"></a>    <span class="dt">p_S1S2  =</span> <span class="kw">rbeta</span>(n_sim, <span class="dv">84</span>, <span class="dv">716</span>),        <span class="co"># prob Sick    -&gt; Sicker</span></span>
<span id="cb112-9"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-9"></a>    </span>
<span id="cb112-10"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-10"></a>    <span class="dt">p_HD    =</span> <span class="kw">rbeta</span>(n_sim, <span class="dv">10</span>, <span class="dv">1990</span>)      ,  <span class="co"># prob Healthy -&gt; Dead</span></span>
<span id="cb112-11"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-11"></a>    <span class="dt">hr_S1   =</span> <span class="kw">rlnorm</span>(n_sim, <span class="kw">log</span>(<span class="dv">3</span>),  <span class="fl">0.01</span>),  <span class="co"># rate ratio death S1 vs healthy</span></span>
<span id="cb112-12"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-12"></a>    <span class="dt">hr_S2   =</span> <span class="kw">rlnorm</span>(n_sim, <span class="kw">log</span>(<span class="dv">10</span>), <span class="fl">0.02</span>),  <span class="co"># rate ratio death S2 vs healthy </span></span>
<span id="cb112-13"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-13"></a>    </span>
<span id="cb112-14"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-14"></a>    <span class="co"># Cost vectors with length n_sim</span></span>
<span id="cb112-15"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-15"></a>    <span class="dt">c_H   =</span> <span class="kw">rgamma</span>(n_sim, <span class="dt">shape =</span> <span class="dv">100</span>, <span class="dt">scale =</span> <span class="dv">20</span>)    , <span class="co"># cost p/cycle in state H</span></span>
<span id="cb112-16"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-16"></a>    <span class="dt">c_S1  =</span> <span class="kw">rgamma</span>(n_sim, <span class="dt">shape =</span> <span class="fl">177.8</span>, <span class="dt">scale =</span> <span class="fl">22.5</span>), <span class="co"># cost p/cycle in state S1</span></span>
<span id="cb112-17"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-17"></a>    <span class="dt">c_S2  =</span> <span class="kw">rgamma</span>(n_sim, <span class="dt">shape =</span> <span class="dv">225</span>, <span class="dt">scale =</span> <span class="fl">66.7</span>)  , <span class="co"># cost p/cycle in state S2</span></span>
<span id="cb112-18"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-18"></a>    <span class="dt">c_D   =</span> <span class="dv">0</span>                                         , <span class="co"># cost p/cycle in state D</span></span>
<span id="cb112-19"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-19"></a>    <span class="dt">c_Trt =</span> c_Trt,                                   <span class="co"># cost p/cycle of treatment</span></span>
<span id="cb112-20"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-20"></a>    </span>
<span id="cb112-21"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-21"></a>    <span class="co"># Utility vectors with length n_sim </span></span>
<span id="cb112-22"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-22"></a>    <span class="dt">u_H   =</span> <span class="kw">rtruncnorm</span>(n_sim, <span class="dt">mean =</span>    <span class="dv">1</span>, <span class="dt">sd =</span> <span class="fl">0.01</span>, <span class="dt">b =</span> <span class="dv">1</span>), <span class="co"># utility when healthy</span></span>
<span id="cb112-23"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-23"></a>    <span class="dt">u_S1  =</span> <span class="kw">rtruncnorm</span>(n_sim, <span class="dt">mean =</span> <span class="fl">0.75</span>, <span class="dt">sd =</span> <span class="fl">0.02</span>, <span class="dt">b =</span> <span class="dv">1</span>), <span class="co"># utility when sick</span></span>
<span id="cb112-24"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-24"></a>    <span class="dt">u_S2  =</span> <span class="kw">rtruncnorm</span>(n_sim, <span class="dt">mean =</span> <span class="fl">0.50</span>, <span class="dt">sd =</span> <span class="fl">0.03</span>, <span class="dt">b =</span> <span class="dv">1</span>), <span class="co"># utility when sicker</span></span>
<span id="cb112-25"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-25"></a>    <span class="dt">u_D   =</span> <span class="dv">0</span>                                               , <span class="co"># utility when dead</span></span>
<span id="cb112-26"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-26"></a>    <span class="dt">u_Trt =</span> <span class="kw">rtruncnorm</span>(n_sim, <span class="dt">mean =</span> <span class="fl">0.95</span>, <span class="dt">sd =</span> <span class="fl">0.02</span>, <span class="dt">b =</span> <span class="dv">1</span>)  <span class="co"># utility when being treated</span></span>
<span id="cb112-27"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-27"></a>  )</span>
<span id="cb112-28"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-28"></a>  </span>
<span id="cb112-29"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-29"></a>  <span class="kw">return</span>(df_psa)</span>
<span id="cb112-30"><a href="user-interfaces-for-health-economic-evaluation.html#cb112-30"></a>}</span></code></pre></div>
</div>
<div id="running-the-model-for-a-specific-set-of-psa-inputs" class="section level4">
<h4><span class="header-section-number">7.3.1.2</span> Running the model for a specific set of PSA inputs</h4>
<p>The function <em>f_MM_sicksicker</em> makes use of the <em>with</em> function which applies an expression (in this case the rest of the code) to a dataset (in this case params, which will be a row of PSA-inputs). It uses the params (one row of PSA inputs) to create a transition probability matrix <em>m_P</em>, and then moves the cohort through the simulation one cycle at a time, recording the proportions in each health state in a markov trace <em>m_TR</em> and applying the transition matrix to calculate the proportions in each health state in the next period <em>m_TR[t+1,]</em>. The function returns a vector of five results: Cost with no treatment, Cost with treatment, QALYs with no treatment and QALYs with treatment and an ICER. In this simple example treatment only influences utilities and costs, not transition probabilities</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-1"></a>f_MM_sicksicker &lt;-<span class="st"> </span><span class="cf">function</span>(params) {</span>
<span id="cb113-2"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-2"></a>  <span class="kw">with</span>(<span class="kw">as.list</span>(params), {</span>
<span id="cb113-3"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-3"></a>    </span>
<span id="cb113-4"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-4"></a>    <span class="co"># compute internal parameters as a function of external parameter</span></span>
<span id="cb113-5"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-5"></a>    r_HD    =<span class="st"> </span><span class="op">-</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_HD) <span class="co"># rate of death in healthy</span></span>
<span id="cb113-6"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-6"></a>    r_S1D   =<span class="st"> </span>hr_S1 <span class="op">*</span><span class="st"> </span>r_HD    <span class="co"># rate of death in sick</span></span>
<span id="cb113-7"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-7"></a>    r_S2D   =<span class="st"> </span>hr_S2 <span class="op">*</span><span class="st"> </span>r_HD      <span class="co"># rate of death in sicker</span></span>
<span id="cb113-8"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-8"></a>    p_S1D   =<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>r_S1D) <span class="co"># probability to die in sick</span></span>
<span id="cb113-9"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-9"></a>    p_S2D   =<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>r_S2D) <span class="co"># probability to die in sicker</span></span>
<span id="cb113-10"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-10"></a>    </span>
<span id="cb113-11"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-11"></a>    <span class="co"># calculate discount weight for each cycle based on discount rate d_r</span></span>
<span id="cb113-12"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-12"></a>    v_dwe &lt;-<span class="st"> </span>v_dwc &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>d_r) <span class="op">^</span><span class="st"> </span>(<span class="dv">0</span><span class="op">:</span>n_t) </span>
<span id="cb113-13"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-13"></a>    </span>
<span id="cb113-14"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-14"></a>    <span class="co"># create transition probability matrix for NO treatment</span></span>
<span id="cb113-15"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-15"></a>    m_P &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,</span>
<span id="cb113-16"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-16"></a>                  <span class="dt">nrow =</span> n_states, <span class="dt">ncol =</span> n_states,</span>
<span id="cb113-17"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-17"></a>                  <span class="dt">dimnames =</span> <span class="kw">list</span>(v_n, v_n))</span>
<span id="cb113-18"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-18"></a>    <span class="co"># fill in the transition probability array</span></span>
<span id="cb113-19"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-19"></a>    <span class="co">### From Healthy</span></span>
<span id="cb113-20"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-20"></a>    m_P[<span class="st">&quot;H&quot;</span>, <span class="st">&quot;H&quot;</span>]  &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(p_HS1 <span class="op">+</span><span class="st"> </span>p_HD)</span>
<span id="cb113-21"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-21"></a>    m_P[<span class="st">&quot;H&quot;</span>, <span class="st">&quot;S1&quot;</span>] &lt;-<span class="st"> </span>p_HS1</span>
<span id="cb113-22"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-22"></a>    m_P[<span class="st">&quot;H&quot;</span>, <span class="st">&quot;D&quot;</span>]  &lt;-<span class="st"> </span>p_HD</span>
<span id="cb113-23"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-23"></a>    <span class="co">### From Sick</span></span>
<span id="cb113-24"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-24"></a>    m_P[<span class="st">&quot;S1&quot;</span>, <span class="st">&quot;H&quot;</span>]  &lt;-<span class="st"> </span>p_S1H</span>
<span id="cb113-25"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-25"></a>    m_P[<span class="st">&quot;S1&quot;</span>, <span class="st">&quot;S1&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(p_S1H <span class="op">+</span><span class="st"> </span>p_S1S2 <span class="op">+</span><span class="st"> </span>p_S1D)</span>
<span id="cb113-26"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-26"></a>    m_P[<span class="st">&quot;S1&quot;</span>, <span class="st">&quot;S2&quot;</span>] &lt;-<span class="st"> </span>p_S1S2</span>
<span id="cb113-27"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-27"></a>    m_P[<span class="st">&quot;S1&quot;</span>, <span class="st">&quot;D&quot;</span>]  &lt;-<span class="st"> </span>p_S1D</span>
<span id="cb113-28"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-28"></a>    <span class="co">### From Sicker</span></span>
<span id="cb113-29"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-29"></a>    m_P[<span class="st">&quot;S2&quot;</span>, <span class="st">&quot;S2&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_S2D</span>
<span id="cb113-30"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-30"></a>    m_P[<span class="st">&quot;S2&quot;</span>, <span class="st">&quot;D&quot;</span>]  &lt;-<span class="st"> </span>p_S2D</span>
<span id="cb113-31"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-31"></a>    <span class="co">### From Dead</span></span>
<span id="cb113-32"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-32"></a>    m_P[<span class="st">&quot;D&quot;</span>, <span class="st">&quot;D&quot;</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb113-33"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-33"></a>    </span>
<span id="cb113-34"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-34"></a>    <span class="co"># create Markov trace (n_t + 1 because R doesn&#39;t understand  Cycle 0)</span></span>
<span id="cb113-35"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-35"></a>    m_TR &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> n_t <span class="op">+</span><span class="st"> </span><span class="dv">1</span> , <span class="dt">ncol =</span> n_states, </span>
<span id="cb113-36"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-36"></a>                   <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="dv">0</span><span class="op">:</span>n_t, v_n))     </span>
<span id="cb113-37"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-37"></a>    </span>
<span id="cb113-38"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-38"></a>    m_TR[<span class="dv">1</span>, ] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)          <span class="co"># initialize Markov trace</span></span>
<span id="cb113-39"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-39"></a>    </span>
<span id="cb113-40"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-40"></a>    <span class="co">############# PROCESS ###########################################</span></span>
<span id="cb113-41"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-41"></a>      </span>
<span id="cb113-42"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-42"></a>    </span>
<span id="cb113-43"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-43"></a>    <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_t){ <span class="co"># throughout the number of cycles</span></span>
<span id="cb113-44"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-44"></a>      <span class="co"># estimate the Markov trace for cycle the next cycle (t + 1)</span></span>
<span id="cb113-45"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-45"></a>      m_TR[t <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, ] &lt;-<span class="st"> </span>m_TR[t, ] <span class="op">%*%</span><span class="st"> </span>m_P           </span>
<span id="cb113-46"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-46"></a>    }</span>
<span id="cb113-47"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-47"></a>    </span>
<span id="cb113-48"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-48"></a>    <span class="co">############ OUTPUT  ###########################################</span></span>
<span id="cb113-49"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-49"></a>    </span>
<span id="cb113-50"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-50"></a>    <span class="co"># create vectors of utility and costs for each state</span></span>
<span id="cb113-51"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-51"></a>    v_u_trt    &lt;-<span class="st"> </span><span class="kw">c</span>(u_H, u_Trt, u_S2, u_D)</span>
<span id="cb113-52"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-52"></a>    v_u_no_trt &lt;-<span class="st"> </span><span class="kw">c</span>(u_H, u_S1, u_S2, u_D)</span>
<span id="cb113-53"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-53"></a>    </span>
<span id="cb113-54"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-54"></a>    v_c_trt    &lt;-<span class="st"> </span><span class="kw">c</span>(c_H, c_S1 <span class="op">+</span><span class="st"> </span>c_Trt, c_S2 <span class="op">+</span><span class="st"> </span>c_Trt, c_D)</span>
<span id="cb113-55"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-55"></a>    v_c_no_trt &lt;-<span class="st"> </span><span class="kw">c</span>(c_H, c_S1, c_S2, c_D)</span>
<span id="cb113-56"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-56"></a>    </span>
<span id="cb113-57"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-57"></a>    <span class="co"># estimate mean QALys and costs</span></span>
<span id="cb113-58"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-58"></a>    v_E_no_trt &lt;-<span class="st"> </span>m_TR <span class="op">%*%</span><span class="st"> </span>v_u_no_trt</span>
<span id="cb113-59"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-59"></a>    v_E_trt    &lt;-<span class="st"> </span>m_TR <span class="op">%*%</span><span class="st"> </span>v_u_trt</span>
<span id="cb113-60"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-60"></a>    </span>
<span id="cb113-61"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-61"></a>    v_C_no_trt &lt;-<span class="st"> </span>m_TR <span class="op">%*%</span><span class="st"> </span>v_c_no_trt</span>
<span id="cb113-62"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-62"></a>    v_C_trt    &lt;-<span class="st"> </span>m_TR <span class="op">%*%</span><span class="st"> </span>v_c_trt</span>
<span id="cb113-63"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-63"></a>    </span>
<span id="cb113-64"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-64"></a>    <span class="co">### discount costs and QALYs</span></span>
<span id="cb113-65"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-65"></a>    te_no_trt &lt;-<span class="st"> </span><span class="kw">t</span>(v_E_no_trt) <span class="op">%*%</span><span class="st"> </span>v_dwe  <span class="co"># 1x31 %*% 31x1 -&gt; 1x1</span></span>
<span id="cb113-66"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-66"></a>    te_trt    &lt;-<span class="st"> </span><span class="kw">t</span>(v_E_trt) <span class="op">%*%</span><span class="st"> </span>v_dwe</span>
<span id="cb113-67"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-67"></a>    </span>
<span id="cb113-68"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-68"></a>    tc_no_trt &lt;-<span class="st"> </span><span class="kw">t</span>(v_C_no_trt) <span class="op">%*%</span><span class="st"> </span>v_dwc</span>
<span id="cb113-69"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-69"></a>    tc_trt    &lt;-<span class="st"> </span><span class="kw">t</span>(v_C_trt)    <span class="op">%*%</span><span class="st"> </span>v_dwc</span>
<span id="cb113-70"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-70"></a>    </span>
<span id="cb113-71"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-71"></a>    results &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Cost_NoTrt&quot;</span> =<span class="st"> </span>tc_no_trt, </span>
<span id="cb113-72"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-72"></a>                 <span class="st">&quot;Cost_Trt&quot;</span>   =<span class="st"> </span>tc_trt, </span>
<span id="cb113-73"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-73"></a>                 <span class="st">&quot;QALY_NoTrt&quot;</span> =<span class="st"> </span>te_no_trt, </span>
<span id="cb113-74"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-74"></a>                 <span class="st">&quot;QALY_Trt&quot;</span>   =<span class="st"> </span>te_trt,</span>
<span id="cb113-75"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-75"></a>                 <span class="st">&quot;ICER&quot;</span>       =<span class="st"> </span>(tc_trt <span class="op">-</span><span class="st"> </span>tc_no_trt)<span class="op">/</span>(te_trt <span class="op">-</span><span class="st"> </span>te_no_trt))</span>
<span id="cb113-76"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-76"></a>    </span>
<span id="cb113-77"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-77"></a>    <span class="kw">return</span>(results)</span>
<span id="cb113-78"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-78"></a>  }</span>
<span id="cb113-79"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-79"></a>  )</span>
<span id="cb113-80"><a href="user-interfaces-for-health-economic-evaluation.html#cb113-80"></a>}</span></code></pre></div>
</div>
</div>
<div id="creating-the-model-wrapper" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Creating the model wrapper</h3>
<p>When using a web application it is likely that the user will want to be able to change parameter inputs and re-run the model. In order to make this simple, we recommend wrapping the entire model into a function. We call this function <em>f_wrapper</em>, using the prefix <em>f_</em> to denote that this is a function.</p>
<p>The wrapper function has as its inputs all the parameters which we may wish to vary using R-Shiny. We set the default values to those of the base model in any report/publication. The model then generates PSA inputs using the <em>f_gen_psa</em> function, creates an empty table of results, and runs the model for each set of PSA inputs (a row from <em>df_psa</em>) in turn. The function then returns the results in the form of a dataframe with n=5 columns and n=psa rows. The columns contain the costs and qalys for treatment and no treatment for each PSA run, as well as an ICER for that PSA run.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-1"></a>f_wrapper &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb114-2"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-2"></a>  </span>
<span id="cb114-3"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-3"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-4"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-4"></a>  <span class="co">#                       User adjustable inputs</span></span>
<span id="cb114-5"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-5"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-6"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-6"></a>  <span class="dt">n_age_init =</span> <span class="dv">25</span>,   <span class="co"># age at baseline default is 25</span></span>
<span id="cb114-7"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-7"></a>  <span class="dt">n_age_max  =</span> <span class="dv">110</span>,  <span class="co"># maximum age of follow up default is 110</span></span>
<span id="cb114-8"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-8"></a>  <span class="dt">d_r     =</span> <span class="fl">0.035</span>,   <span class="co"># discount rate for costs &amp; QALYS (NICE 3.5%)</span></span>
<span id="cb114-9"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-9"></a>  <span class="dt">n_sim   =</span> <span class="dv">1000</span>,    <span class="co"># number of simulations default 1000</span></span>
<span id="cb114-10"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-10"></a>  <span class="dt">c_Trt   =</span> <span class="dv">50</span>       <span class="co"># cost of treatment default 50</span></span>
<span id="cb114-11"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-11"></a></span>
<span id="cb114-12"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-12"></a>  ){</span>
<span id="cb114-13"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-13"></a>  </span>
<span id="cb114-14"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-14"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-15"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-15"></a>  <span class="co">#                       Unadjustable inputs</span></span>
<span id="cb114-16"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-16"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-17"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-17"></a>  n_t &lt;-<span class="st"> </span>n_age_max <span class="op">-</span><span class="st"> </span>n_age_init <span class="co"># time horizon, number of cycles</span></span>
<span id="cb114-18"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-18"></a>  v_n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;H&quot;</span>, <span class="st">&quot;S1&quot;</span>, <span class="st">&quot;S2&quot;</span>, <span class="st">&quot;D&quot;</span>) <span class="co"># the 4 health states of the model:</span></span>
<span id="cb114-19"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-19"></a>  n_states &lt;-<span class="st"> </span><span class="kw">length</span>(v_n) <span class="co"># number of health states </span></span>
<span id="cb114-20"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-20"></a></span>
<span id="cb114-21"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-21"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-22"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-22"></a>  <span class="co">#                       Create PSA Inputs</span></span>
<span id="cb114-23"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-23"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-24"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-24"></a>  </span>
<span id="cb114-25"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-25"></a>  df_psa &lt;-<span class="st"> </span><span class="kw">f_gen_psa</span>(<span class="dt">n_sim =</span> n_sim, <span class="dt">c_Trt =</span>  c_Trt)</span>
<span id="cb114-26"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-26"></a></span>
<span id="cb114-27"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-27"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-28"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-28"></a>  <span class="co">#                       Run PSA</span></span>
<span id="cb114-29"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-29"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-30"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-30"></a></span>
<span id="cb114-31"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-31"></a>  <span class="co"># Initialize matrix of results outcomes</span></span>
<span id="cb114-32"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-32"></a>  m_out &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NaN</span>, </span>
<span id="cb114-33"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-33"></a>                 <span class="dt">nrow =</span> n_sim, </span>
<span id="cb114-34"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-34"></a>                 <span class="dt">ncol =</span> <span class="dv">5</span>,</span>
<span id="cb114-35"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-35"></a>                 <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span>n_sim,<span class="kw">c</span>(<span class="st">&quot;Cost_NoTrt&quot;</span>, <span class="st">&quot;Cost_Trt&quot;</span>,</span>
<span id="cb114-36"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-36"></a>                                           <span class="st">&quot;QALY_NoTrt&quot;</span>, <span class="st">&quot;QALY_Trt&quot;</span>,</span>
<span id="cb114-37"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-37"></a>                                           <span class="st">&quot;ICER&quot;</span>)))</span>
<span id="cb114-38"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-38"></a>  <span class="co"># loop through psa inputs running the model for each.</span></span>
<span id="cb114-39"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-39"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n_sim){</span>
<span id="cb114-40"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-40"></a>    <span class="co"># store results in one row of results matrix</span></span>
<span id="cb114-41"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-41"></a>    m_out[i,] &lt;-<span class="st"> </span><span class="kw">f_MM_sicksicker</span>(df_psa[i, ])</span>
<span id="cb114-42"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-42"></a>    </span>
<span id="cb114-43"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-43"></a>    <span class="co"># display the progress of the simulation</span></span>
<span id="cb114-44"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-44"></a>    <span class="kw">cat</span>(<span class="st">&#39;</span><span class="ch">\r</span><span class="st">&#39;</span>, <span class="kw">paste</span>(<span class="kw">round</span>(i<span class="op">/</span>n_sim <span class="op">*</span><span class="st"> </span><span class="dv">100</span>), <span class="st">&quot;% done&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>))       </span>
<span id="cb114-45"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-45"></a>  }</span>
<span id="cb114-46"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-46"></a>  </span>
<span id="cb114-47"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-47"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-48"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-48"></a>  <span class="co">#                      Return results</span></span>
<span id="cb114-49"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-49"></a>  <span class="co">#================================================================</span></span>
<span id="cb114-50"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-50"></a>  </span>
<span id="cb114-51"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-51"></a>  df_out &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(m_out) <span class="co"># convert matrix to dataframe (for plots)</span></span>
<span id="cb114-52"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-52"></a>  </span>
<span id="cb114-53"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-53"></a>  <span class="kw">return</span>(df_out) <span class="co"># output the dataframe from the function</span></span>
<span id="cb114-54"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-54"></a>  </span>
<span id="cb114-55"><a href="user-interfaces-for-health-economic-evaluation.html#cb114-55"></a>  }</span></code></pre></div>
</div>
<div id="integrating-into-r-shiny" class="section level3">
<h3><span class="header-section-number">7.3.3</span> Integrating into R-Shiny</h3>
<p>The method so far has involved wrapping the model into a function, which takes some inputs and returns a single data-frame output. The next step is to integrate the model function into a Shiny web-app. This is done within a single R file, which we call <em>app.R</em>. This can be found here: <a href="https://github.com/RobertASmith/healthecon_shiny/tree/master/App">https://github.com/RobertASmith/healthecon_shiny/tree/master/App</a>.</p>
<p>The app.R script has three main parts, each are addressed in turn below:
- set-up (getting everything ready so the user-interface and server can be created)
- user interface (what people will see)
- server (stuff going on in the background)</p>
<p>As shown in Figure 1 below, the parameters which are varied in the user interface are a subgroup of inputs into the wrapped up model (the rest of the inputs coming from within the server). The model function has one output, a table of results, which are used within the server to create tables and plots. These are sent back to the user interface to be displayed as shiny outputs.</p>
<div class="figure">
<img src="_bookdown_files/bookdown-demo_files/figures-shiny/shiny_function_app.PNG" alt="" />
<p class="caption">Diagram depecting how the code for the Sick-Sicker app is structured</p>
</div>
<div id="set-up" class="section level4">
<h4><span class="header-section-number">7.3.3.1</span> Set-up</h4>
<p>The set-up is relatively simple, load the R-Shiny package from your library so that you can use the <em>shinyApp</em> function. The next step is to use the <em>source</em> function in baseR to run the script which creates the <em>f_wrapper</em> function, being careful to ensure your relative path is correct (‘./wrapper.R’ should work if the app.R file is within the same folder). The function <em>shinyApp</em> at the end of the app file is reliant on the <em>shiny</em> package so please ensure that the <em>shiny</em> package is installed, using <em>install.packages(“shiny”)</em> if it is not.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="user-interfaces-for-health-economic-evaluation.html#cb115-1"></a><span class="co"># install.packages(&quot;shiny&quot;) # necessary if you don&#39;t already have the function &#39;shiny&#39; installed.</span></span>
<span id="cb115-2"><a href="user-interfaces-for-health-economic-evaluation.html#cb115-2"></a></span>
<span id="cb115-3"><a href="user-interfaces-for-health-economic-evaluation.html#cb115-3"></a><span class="co"># we need the function shiny installed, this loads it from the library.</span></span>
<span id="cb115-4"><a href="user-interfaces-for-health-economic-evaluation.html#cb115-4"></a><span class="kw">library</span>(shiny)             </span>
<span id="cb115-5"><a href="user-interfaces-for-health-economic-evaluation.html#cb115-5"></a></span>
<span id="cb115-6"><a href="user-interfaces-for-health-economic-evaluation.html#cb115-6"></a><span class="co"># source the wrapper function.</span></span>
<span id="cb115-7"><a href="user-interfaces-for-health-economic-evaluation.html#cb115-7"></a><span class="kw">source</span>(<span class="st">&quot;./wrapper.R&quot;</span>)   </span></code></pre></div>
</div>
<div id="user-interface" class="section level4">
<h4><span class="header-section-number">7.3.3.2</span> User Interface</h4>
<p>The user interface is extremely flexible, we show the code for a very simple structure (fluidpage) with a sidebar containing inputs and a main panel containing outputs. We have done very little formatting in order to minimize the quantity of code while maintaining basic functionality. In order to get an aesthetically pleasing application we recommend much more sophisticated formatting, relying on CSS, HTML and Javascript.</p>
<p>The example user interface displayed in Figure 2 and online at <a href="https://robertasmith.shinyapps.io/sick_sicker/">https://robertasmith.shinyapps.io/sick_sicker/</a>. It is made up of two components, a titlepanel and a sidebar layout display. The sidebarLayout display has within it a sidebar and a main panel. These two components are contained within the <em>fluidpage</em> function which creates the user interface (ui).</p>
<div class="figure">
<img src="_bookdown_files/bookdown-demo_files/figures-shiny/sick_sicker_app.PNG" alt="" />
<p class="caption">ScreenPrint of Sick-Sicker user interface</p>
</div>
<p>The title panel contains the title “Sick Sicker Model in Shiny”, the sidebar panel contains two numeric inputs and a slider input (“Treatment Cost”, “PSA runs”, “Initial Age”) and an Action Button (“Run / update model”).</p>
<p>The values of the inputs have ID tags (names) which are recognised and used by the server function, we denote these with the prefix “SI” to indicate they are ‘Shiny Input’ objects (<em>SI_c_Trt</em>, <em>SI_n_sim</em>, <em>SI_n_age_init</em>). Note that this is an addition of the coding framework provided by Alarid-Escudero et al., (2019).</p>
<p>The action button also has an id, this is not an input into the model wrapper (f_wrapper) so we leave out the SI and call it “run_model”.</p>
<p>The main panel contains two objects which have been output from the server: <em>tableOutput(“SO_icer_table”)</em> is a table of results, and <em>plotOutput(“SO_CE_plane”)</em> is a cost-effectiveness plane plot. It is important that the format (e.g. tableOutput) matches the format of the object from the server (e.g. <em>SO_icer_table</em>). Again, the <em>SO</em> prefix reflects the fact that these are Shiny Outputs. The two h3() functions are simply headings which appear as “Results Table” and “Cost-effectiveness Plane”.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-1"></a>  <span class="co">#================================================================</span></span>
<span id="cb116-2"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-2"></a>  <span class="co">#                   Create User Interface</span></span>
<span id="cb116-3"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-3"></a>  <span class="co">#================================================================</span></span>
<span id="cb116-4"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-4"></a></span>
<span id="cb116-5"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-5"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(    <span class="co"># creates empty page, which we will fill</span></span>
<span id="cb116-6"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-6"></a>  </span>
<span id="cb116-7"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-7"></a>  <span class="kw">titlePanel</span>(<span class="st">&quot;Sick Sicker Model in Shiny&quot;</span>),   <span class="co"># title of app</span></span>
<span id="cb116-8"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-8"></a>  </span>
<span id="cb116-9"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-9"></a>  <span class="co"># SIDEBAR</span></span>
<span id="cb116-10"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-10"></a>  <span class="kw">sidebarLayout</span>(    <span class="co"># indicates layout is going to be a sidebar-layout</span></span>
<span id="cb116-11"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-11"></a>    </span>
<span id="cb116-12"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-12"></a>    <span class="kw">sidebarPanel</span>( <span class="co"># open sidebar panel</span></span>
<span id="cb116-13"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-13"></a>    </span>
<span id="cb116-14"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-14"></a>    <span class="kw">numericInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;SI_c_Trt&quot;</span>,      <span class="co"># id of input, used in server</span></span>
<span id="cb116-15"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-15"></a>                 <span class="dt">label =</span> <span class="st">&quot;Treatment Cost&quot;</span>,  <span class="co"># label next to numeric input</span></span>
<span id="cb116-16"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-16"></a>                 <span class="dt">value =</span> <span class="dv">200</span>,               <span class="co"># initial value</span></span>
<span id="cb116-17"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-17"></a>                 <span class="dt">min =</span> <span class="dv">0</span>,                   <span class="co"># minimum value allowed</span></span>
<span id="cb116-18"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-18"></a>                 <span class="dt">max =</span> <span class="dv">400</span>),                <span class="co"># maximum value allowed</span></span>
<span id="cb116-19"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-19"></a>    </span>
<span id="cb116-20"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-20"></a>    <span class="kw">numericInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;SI_n_sim&quot;</span>,      <span class="co"># id of input, used in server</span></span>
<span id="cb116-21"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-21"></a>                 <span class="dt">label =</span> <span class="st">&quot;PSA runs&quot;</span>,        <span class="co"># label next to numeric input</span></span>
<span id="cb116-22"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-22"></a>                 <span class="dt">value =</span> <span class="dv">1000</span>,              <span class="co"># initial value</span></span>
<span id="cb116-23"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-23"></a>                 <span class="dt">min =</span> <span class="dv">0</span>,                   <span class="co"># minimum value allowed</span></span>
<span id="cb116-24"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-24"></a>                 <span class="dt">max =</span> <span class="dv">400</span>),                <span class="co"># maximum value allowed</span></span>
<span id="cb116-25"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-25"></a>    </span>
<span id="cb116-26"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-26"></a>    <span class="kw">sliderInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;SI_n_age_init&quot;</span>,  <span class="co"># id of input, used in server</span></span>
<span id="cb116-27"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-27"></a>                <span class="dt">label =</span> <span class="st">&quot;Initial Age&quot;</span>,      <span class="co"># label next to numeric input</span></span>
<span id="cb116-28"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-28"></a>                <span class="dt">value =</span> <span class="dv">25</span>,                 <span class="co"># initial value</span></span>
<span id="cb116-29"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-29"></a>                <span class="dt">min =</span> <span class="dv">10</span>,                   <span class="co"># minimum value allowed</span></span>
<span id="cb116-30"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-30"></a>                <span class="dt">max =</span> <span class="dv">80</span>),                  <span class="co"># maximum value allowed</span></span>
<span id="cb116-31"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-31"></a>    </span>
<span id="cb116-32"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-32"></a></span>
<span id="cb116-33"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-33"></a>    <span class="kw">actionButton</span>(<span class="dt">inputId =</span> <span class="st">&quot;run_model&quot;</span>,     <span class="co"># id of action button, used in server</span></span>
<span id="cb116-34"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-34"></a>                 <span class="dt">label   =</span> <span class="st">&quot;Run model&quot;</span>)     <span class="co"># action button label (on button)</span></span>
<span id="cb116-35"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-35"></a>                       </span>
<span id="cb116-36"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-36"></a>                ),  <span class="co"># close sidebarPanel</span></span>
<span id="cb116-37"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-37"></a>    </span>
<span id="cb116-38"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-38"></a>  <span class="kw">mainPanel</span>(                                <span class="co"># open main panel</span></span>
<span id="cb116-39"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-39"></a>    </span>
<span id="cb116-40"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-40"></a>    <span class="kw">h3</span>(<span class="st">&quot;Results Table&quot;</span>),                    <span class="co"># heading (results table)                </span></span>
<span id="cb116-41"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-41"></a>    </span>
<span id="cb116-42"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-42"></a>    <span class="kw">tableOutput</span>(<span class="dt">outputId =</span> <span class="st">&quot;SO_icer_table&quot;</span>),   <span class="co"># tableOutput id = icer_table, from server</span></span>
<span id="cb116-43"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-43"></a>    </span>
<span id="cb116-44"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-44"></a>    <span class="kw">h3</span>(<span class="st">&quot;Cost-effectiveness Plane&quot;</span>),         <span class="co"># heading (Cost effectiveness plane)</span></span>
<span id="cb116-45"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-45"></a>    </span>
<span id="cb116-46"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-46"></a>    <span class="kw">plotOutput</span>(<span class="dt">outputId =</span> <span class="st">&quot;SO_CE_plane&quot;</span>)       <span class="co"># plotOutput id = CE_plane, from server</span></span>
<span id="cb116-47"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-47"></a>    </span>
<span id="cb116-48"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-48"></a>            ) <span class="co"># close mainpanel    </span></span>
<span id="cb116-49"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-49"></a>      </span>
<span id="cb116-50"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-50"></a>      ) <span class="co"># close sidebarlayout</span></span>
<span id="cb116-51"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-51"></a>                     </span>
<span id="cb116-52"><a href="user-interfaces-for-health-economic-evaluation.html#cb116-52"></a>  ) <span class="co"># close UI fluidpage</span></span></code></pre></div>
</div>
<div id="server" class="section level4">
<h4><span class="header-section-number">7.3.3.3</span> Server</h4>
<p>The server is marginally more complicated than the user interface. It is created by a function with inputs and outputs. The observe event indicates that when the action button (run_model) is pressed the code within the curly brackets is run. The code will be re-run if the button is pressed again.</p>
<p>The first thing that happens when the run_model button is pressed is that the model wrapper function <em>f_wrapper</em> is run with the user interface inputs (<em>SI_c_Trt</em>, <em>SI_n_age_init</em>, <em>SI_n_sim</em>) as inputs to the function. The <em>input$</em> prefix indicates that the objects have come from the user interface. The results of the model are stored as the dataframe object <em>df_model_res</em>.</p>
<p>The ICER table is then created and output (note the prefix <em>output$</em>) in the object <em>SO_icer_table</em>. See previous section on the user interface and note that the <em>tableOutput</em> function has as an input <em>SO_icer_table</em>. The function <em>renderTable</em> rerenders the table continuously so that the table always reflects the values from the data-frame of results created above. In this simple example we have created a table of results using code within the script. In reality we would generally use a custom function which creates a publication quality table which is aesthetically pleasing. There are numerous packages which provide this functionality (e.g. BCEA, Darthpack, Heemod)</p>
<p>The cost-effectiveness plane is created in a similar process, using the <em>renderPlot</em> function to continuously update a plot which is created using baseR plot function using incremental costs and QALYs calculated from the results dataframe <em>df_model_res</em>. For aesthetic purposes we recommend this is replaced by a ggplot or plotly plot which has much improved functionality. Again, there are packages available for this (e.g. Heemod, BCEA, Darthpack)</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-1"></a>  <span class="co">#================================================================</span></span>
<span id="cb117-2"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-2"></a>  <span class="co">#                     Create Server Function</span></span>
<span id="cb117-3"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-3"></a>  <span class="co">#================================================================</span></span>
<span id="cb117-4"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-4"></a></span>
<span id="cb117-5"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-5"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output){   <span class="co"># server = function with two inputs</span></span>
<span id="cb117-6"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-6"></a>  </span>
<span id="cb117-7"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-7"></a> <span class="kw">observeEvent</span>(input<span class="op">$</span>run_model,       <span class="co"># when action button pressed ...</span></span>
<span id="cb117-8"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-8"></a>              <span class="dt">ignoreNULL =</span> F, {</span>
<span id="cb117-9"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-9"></a>    </span>
<span id="cb117-10"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-10"></a>  <span class="co"># Run model wrapper function with the Shiny inputs and store as data-frame </span></span>
<span id="cb117-11"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-11"></a>  df_model_res =<span class="st"> </span><span class="kw">f_wrapper</span>(<span class="dt">c_Trt =</span> input<span class="op">$</span>SI_c_Trt,</span>
<span id="cb117-12"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-12"></a>                           <span class="dt">n_age_init =</span> input<span class="op">$</span>SI_n_age_init,</span>
<span id="cb117-13"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-13"></a>                           <span class="dt">n_sim =</span> input<span class="op">$</span>SI_n_sim)</span>
<span id="cb117-14"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-14"></a>    </span>
<span id="cb117-15"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-15"></a>  </span>
<span id="cb117-16"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-16"></a>    <span class="co">#--- CREATE COST EFFECTIVENESS TABLE ---#</span></span>
<span id="cb117-17"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-17"></a>    output<span class="op">$</span>SO_icer_table &lt;-<span class="st"> </span><span class="kw">renderTable</span>({ <span class="co"># this continuously updates table</span></span>
<span id="cb117-18"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-18"></a>      </span>
<span id="cb117-19"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-19"></a>      df_res_table &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="co"># create dataframe</span></span>
<span id="cb117-20"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-20"></a>        </span>
<span id="cb117-21"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-21"></a>        <span class="dt">Option =</span>  <span class="kw">c</span>(<span class="st">&quot;Treatment&quot;</span>,<span class="st">&quot;No Treatment&quot;</span>), </span>
<span id="cb117-22"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-22"></a>        </span>
<span id="cb117-23"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-23"></a>        <span class="dt">QALYs  =</span>  <span class="kw">c</span>(<span class="kw">mean</span>(df_model_res<span class="op">$</span>QALY_Trt),<span class="kw">mean</span>(df_model_res<span class="op">$</span>QALY_NoTrt)),</span>
<span id="cb117-24"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-24"></a>        </span>
<span id="cb117-25"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-25"></a>        <span class="dt">Costs  =</span>  <span class="kw">c</span>(<span class="kw">mean</span>(df_model_res<span class="op">$</span>Cost_Trt),<span class="kw">mean</span>(df_model_res<span class="op">$</span>Cost_NoTrt)),</span>
<span id="cb117-26"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-26"></a>        </span>
<span id="cb117-27"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-27"></a>        <span class="dt">Inc.QALYs =</span> <span class="kw">c</span>(<span class="kw">mean</span>(df_model_res<span class="op">$</span>QALY_Trt) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(df_model_res<span class="op">$</span>QALY_NoTrt),<span class="ot">NA</span>),</span>
<span id="cb117-28"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-28"></a>        </span>
<span id="cb117-29"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-29"></a>        <span class="dt">Inc.Costs =</span> <span class="kw">c</span>(<span class="kw">mean</span>(df_model_res<span class="op">$</span>Cost_Trt) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(df_model_res<span class="op">$</span>Cost_NoTrt),<span class="ot">NA</span>),</span>
<span id="cb117-30"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-30"></a>        </span>
<span id="cb117-31"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-31"></a>        <span class="dt">ICER =</span> <span class="kw">c</span>(<span class="kw">mean</span>(df_model_res<span class="op">$</span>ICER),<span class="ot">NA</span>)</span>
<span id="cb117-32"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-32"></a>      )</span>
<span id="cb117-33"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-33"></a>      </span>
<span id="cb117-34"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-34"></a>      <span class="co"># round the dataframe to two digits so looks tidier</span></span>
<span id="cb117-35"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-35"></a>      df_res_table[,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(df_res_table[,<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>],<span class="dt">digits =</span> <span class="dv">2</span>) </span>
<span id="cb117-36"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-36"></a>      </span>
<span id="cb117-37"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-37"></a>      <span class="co"># print the results table</span></span>
<span id="cb117-38"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-38"></a>      df_res_table</span>
<span id="cb117-39"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-39"></a></span>
<span id="cb117-40"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-40"></a>      }) <span class="co"># table plot end.</span></span>
<span id="cb117-41"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-41"></a>    </span>
<span id="cb117-42"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-42"></a>    </span>
<span id="cb117-43"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-43"></a>   <span class="co">#---  CREATE COST EFFECTIVENESS PLANE ---#</span></span>
<span id="cb117-44"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-44"></a>    output<span class="op">$</span>SO_CE_plane &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({ <span class="co"># render plot repeatedly updates.</span></span>
<span id="cb117-45"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-45"></a>      </span>
<span id="cb117-46"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-46"></a>      <span class="co"># calculate incremental costs and qalys from results dataframe</span></span>
<span id="cb117-47"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-47"></a>      df_model_res<span class="op">$</span>inc_C &lt;-<span class="st"> </span>df_model_res<span class="op">$</span>Cost_Trt <span class="op">-</span><span class="st"> </span>df_model_res<span class="op">$</span>Cost_NoTrt</span>
<span id="cb117-48"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-48"></a>      df_model_res<span class="op">$</span>inc_Q &lt;-<span class="st"> </span>df_model_res<span class="op">$</span>QALY_Trt <span class="op">-</span><span class="st"> </span>df_model_res<span class="op">$</span>QALY_NoTrt</span>
<span id="cb117-49"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-49"></a>      </span>
<span id="cb117-50"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-50"></a>      <span class="co"># create cost effectiveness plane plot</span></span>
<span id="cb117-51"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-51"></a>      <span class="kw">plot</span>(<span class="dt">x =</span> df_model_res<span class="op">$</span>inc_Q, <span class="co"># x axis incremental QALYS</span></span>
<span id="cb117-52"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-52"></a>           <span class="dt">y =</span> df_model_res<span class="op">$</span>inc_C, <span class="co"># y axis incremental Costs</span></span>
<span id="cb117-53"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-53"></a>           <span class="co">#label axes</span></span>
<span id="cb117-54"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-54"></a>           <span class="dt">xlab =</span> <span class="st">&quot;Incremental QALYs&quot;</span>, </span>
<span id="cb117-55"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-55"></a>           <span class="dt">ylab =</span> <span class="st">&quot;Incremental Costs&quot;</span>, </span>
<span id="cb117-56"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-56"></a>           </span>
<span id="cb117-57"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-57"></a>           <span class="co"># set xlimits and ylimits for plot.</span></span>
<span id="cb117-58"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-58"></a>           <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="kw">min</span>(df_model_res<span class="op">$</span>inc_Q,df_model_res<span class="op">$</span>inc_Q<span class="op">*-</span><span class="dv">1</span>),</span>
<span id="cb117-59"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-59"></a>                    <span class="kw">max</span>(df_model_res<span class="op">$</span>inc_Q,df_model_res<span class="op">$</span>inc_Q<span class="op">*-</span><span class="dv">1</span>)),</span>
<span id="cb117-60"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-60"></a>           <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(df_model_res<span class="op">$</span>inc_C,df_model_res<span class="op">$</span>inc_C<span class="op">*-</span><span class="dv">1</span>),</span>
<span id="cb117-61"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-61"></a>                    <span class="kw">max</span>(df_model_res<span class="op">$</span>inc_C,df_model_res<span class="op">$</span>inc_C<span class="op">*-</span><span class="dv">1</span>)),</span>
<span id="cb117-62"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-62"></a>           <span class="co"># include y and y axis lines.</span></span>
<span id="cb117-63"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-63"></a>           <span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>,<span class="dt">v=</span><span class="dv">0</span>)</span>
<span id="cb117-64"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-64"></a>          ) <span class="co"># plot end </span></span>
<span id="cb117-65"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-65"></a>    }) <span class="co"># renderplot end</span></span>
<span id="cb117-66"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-66"></a>    </span>
<span id="cb117-67"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-67"></a> }) <span class="co"># Observe Event End</span></span>
<span id="cb117-68"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-68"></a>    </span>
<span id="cb117-69"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-69"></a>    </span>
<span id="cb117-70"><a href="user-interfaces-for-health-economic-evaluation.html#cb117-70"></a>  } <span class="co"># Server end</span></span></code></pre></div>
</div>
<div id="running-the-app" class="section level4">
<h4><span class="header-section-number">7.3.3.4</span> Running the app</h4>
<p>The app can be run within the R file using the function <em>shinyApp</em> which depends on the <em>ui</em> and <em>server</em> which have been created and described above. Running this creates a Shiny application in the local environment (e.g. your desktop). In order to deploy the application onto the web the app needs to be <em>published</em> using the publish button in the top right corner of the R-file in RStudio (next to run-app). A step by step guide to this process can be found on the R-Shiny website <a href="https://shiny.rstudio.com/deploy/">https://shiny.rstudio.com/deploy/</a>.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="user-interfaces-for-health-economic-evaluation.html#cb118-1"></a><span class="co">## ----- run app------</span></span>
<span id="cb118-2"><a href="user-interfaces-for-health-economic-evaluation.html#cb118-2"></a></span>
<span id="cb118-3"><a href="user-interfaces-for-health-economic-evaluation.html#cb118-3"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
<div id="additional-functionality" class="section level4">
<h4><span class="header-section-number">7.3.3.5</span> Additional Functionality</h4>
<p>The example Sick-Sicker web-app which has been created is a simple, but functional, R-Shiny user interface for a health economic model. There are a number of additional functionalities which we have used for various projects:</p>
<ul>
<li><p>ability to fully customise the aesthetics of the user interface similar to standard web-design.</p></li>
<li><p>ability to upload files containing input parameters to the app before running the model.</p></li>
<li><p>ability to download figures and tables from the app.</p></li>
<li><p>ability to download a full markdown report which updates all numbers, tables and figures in the report based on the user inputs and model outputs.</p></li>
<li><p>ability to select the comparitor and treatment(s) where multiple treatments exist.</p></li>
</ul>
<p>It is also possible to integrate network meta-analysis (NMA), the economic model, and value of information analysis (VOI) in a single application. After selecting NMA inputs (e.g. a subgroup of effectiveness studies) and economic model inputs (e.g. costs of treatments) and then clicking the ‘run’ button, a user would be presented with results of the NMA, economic model and VOI in one simple user-interface. They would then be able to download a report with all of the relevant information updated (e.g. numbers, tables, figures). We believe this is the future of health economics.</p>
</div>
</div>
</div>
<div id="discussion" class="section level2">
<h2><span class="header-section-number">7.4</span> Discussion</h2>
<p>In this paper, we demonstrated how to generate a user-friendly interface for an economic model programed in R, using the Shiny package. This tutorial shows that the process is relatively simple and requires limited additional programming knowledge than that required to build a decision model in R.</p>
<p>The movement towards script based health economic models with web based user interfaces is particularly useful in situations where a general model structure has been created with a variety of stakeholders in mind, each of which may have different input parameters and wish to conduct sensitivity analysis specific to their decision. For example the World Health Organisation Department of Sexual and Reproductive Health and Research recently embedded a Shiny application into their website <a href="https://srhr.org/fgmcost/cost-calculator/">https://srhr.org/fgmcost/cost-calculator/</a>. The application runs a heemod model <span class="citation">(Filipovic-Pierucci, Zarca, and Durand-Zaleski <a href="#ref-heemod" role="doc-biblioref">2016</a>)</span> in R in an external server, and allows users to select their country and change country specific input parameters, run the model and display results. The process of engagement, the ability to ‘play’ with the model and test the extremes of the decision makers’ assumptions gives stakeholders more control over models, making them feel less like black boxes. While there is a danger that a mis-informed stakeholder may make a mistake in their choice of parameter, we should remember that the role of the model is to inform decision-makers not instruct them … and besides: it is simple to limit the range that parameter inputs can take.</p>
<p>The authors’ experience of creating user-interfaces for decision models has led us to the conclusion that the most efficient method is to work iteratively, first ensuring that the model is working as intended before making incremental changes to the user interface and server one item at a time. While experienced programmers can make substantial time savings by combining multiple steps we have found that the time taken to correct mistakes far outweighs the time savings associated with combining steps.</p>
<p>There are several challenges that exist with the movement toward script based models with web-based user-interfaces. The first is the challenge of upskilling health economists used to working in Microsoft Excel. We hope that this tutorial provides a useful addition to previous tutorials demonstrating how to construct decsion models in R <span class="citation">(Alarid-Escudero et al. <a href="#ref-alarid2020cohort" role="doc-biblioref">2020</a>)</span>. A second, and crucial challenge to overcome, is a concern about deploying highly sensitive data and methods to an external server. While server providers such as ShinyIO provide assurances of SSR encryption and user authentication clients with particularly sensitive data may still have concerns. This problem can be avoided in two ways: firstly if clients have their own server and the ability to deploy applications they can maintain control of all data and code, and secondly the application could simply not be deployed, and instead simply created during a meeting using code and data shared in a zip file. Finally, a challenge (and opportunity) exists to create user-interfaces that are most user-friendly for decision makers in this field, this is an area of important research which can be used to inform teaching content for years to come.</p>
</div>
<div id="conclusion" class="section level2">
<h2><span class="header-section-number">7.5</span> Conclusion</h2>
<p>The creation of web application user interfaces for health economic models constructed in high level programming languages should improve their usability, allowing stakeholders and third parties with no programming knowledge to conduct their own sensitivity analysis remotely. This tutorial provides a reference for those attempting to create a user interface for a health economic model created in R. Further work is necessary to better understand how to design interfaces which best meet the needs of different decision makers.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-alarid2020cohort">
<p>Alarid-Escudero, Fernando, Eline M Krijkamp, Eva A Enns, MG Hunink, Petros Pechlivanoglou, and Hawre Jalal. 2020. “Cohort State-Transition Models in R: From Conceptualization to Implementation.” <em>arXiv Preprint arXiv:2001.07824</em>.</p>
</div>
<div id="ref-alarid2019need">
<p>Alarid-Escudero, Fernando, Eline M Krijkamp, Petros Pechlivanoglou, Hawre Jalal, Szu-Yu Zoe Kao, Alan Yang, and Eva A Enns. 2019. “A Need for Change! A Coding Framework for Improving Transparency in Decision Modeling.” <em>PharmacoEconomics</em> 37 (11): 1329–39.</p>
</div>
<div id="ref-baio2017bceaweb">
<p>Baio, Gianluca, Andrea Berardi, and Anna Heath. 2017. “BCEAweb: A User-Friendly Web-App to Use Bcea.” In <em>Bayesian Cost-Effectiveness Analysis with the R Package Bcea</em>, 153–66. Springer.</p>
</div>
<div id="ref-baio2017simple">
<p>Baio, Gianluca, and Anna Heath. 2017. “When Simple Becomes Complicated: Why Excel Should Lose Its Place at the Top Table.” SAGE Publications Sage UK: London, England.</p>
</div>
<div id="ref-beeley2016web">
<p>Beeley, Chris. 2016. <em>Web Application Development with R Using Shiny</em>. Packt Publishing Ltd.</p>
</div>
<div id="ref-heemod">
<p>Filipovic-Pierucci, A, K Zarca, and I Durand-Zaleski. 2016. “Markov Models for Health Economic Evaluation Modelling in R with the Heemod Package.” <em>Value in Health</em> 19 (7): A369.</p>
</div>
<div id="ref-gendron2016introduction">
<p>Gendron, Jay. 2016. <em>Introduction to R for Business Intelligence</em>. Packt Publishing Ltd.</p>
</div>
<div id="ref-hatswell2017sharing">
<p>Hatswell, Anthony J, and Fleur Chandler. 2017. “Sharing Is Caring: The Case for Company-Level Collaboration in Pharmacoeconomic Modelling.” <em>PharmacoEconomics</em> 35 (8): 755–57.</p>
</div>
<div id="ref-national2014guide">
<p>Health, National Institute for, and Care Excellence (Great Britain). 2014. <em>Guide to the Processes of Technology Appraisal</em>. National Institute for Health; Care Excellence.</p>
</div>
<div id="ref-incerti2019r">
<p>Incerti, Devin, Howard Thom, Gianluca Baio, and Jeroen P Jansen. 2019. “R You Still Using Excel? The Advantages of Modern Software Tools for Health Technology Assessment.” <em>Value in Health</em> 22 (5): 575–79.</p>
</div>
<div id="ref-jalal2017overview">
<p>Jalal, Hawre, Petros Pechlivanoglou, Eline Krijkamp, Fernando Alarid-Escudero, Eva Enns, and MG Myriam Hunink. 2017. “An Overview of R in Health Decision Sciences.” <em>Medical Decision Making</em> 37 (7): 735–46.</p>
</div>
<div id="ref-jansen2019developing">
<p>Jansen, Jeroen P, Devin Incerti, and Mark T Linthicum. 2019. “Developing Open-Source Models for the Us Health System: Practical Experiences and Challenges to Date with the Open-Source Value Project.” <em>PharmacoEconomics</em> 37 (11): 1313–20.</p>
</div>
<div id="ref-krijkamp2018microsimulation">
<p>Krijkamp, Eline M, Fernando Alarid-Escudero, Eva A Enns, Hawre J Jalal, MG Myriam Hunink, and Petros Pechlivanoglou. 2018. “Microsimulation Modeling for Health Decision Sciences Using R: A Tutorial.” <em>Medical Decision Making</em> 38 (3): 400–422.</p>
</div>
<div id="ref-owen2019metainsight">
<p>Owen, Rhiannon K, Naomi Bradbury, Yiqiao Xin, Nicola Cooper, and Alex Sutton. 2019. “MetaInsight: An Interactive Web-Based Tool for Analyzing, Interrogating, and Visualizing Network Meta-Analyses Using R-Shiny and Netmeta.” <em>Research Synthesis Methods</em>.</p>
</div>
<div id="ref-strong2014estimating">
<p>Strong, Mark, Jeremy E Oakley, and Alan Brennan. 2014. “Estimating Multiparameter Partial Expected Value of Perfect Information from a Probabilistic Sensitivity Analysis Sample: A Nonparametric Regression Approach.” <em>Medical Decision Making</em> 34 (3): 311–26.</p>
</div>
<div id="ref-DARTH">
<p>Workgroup, DARTH. 2020. “Decision Analysis in R for Technologies in Health.” 2020. <a href="http://darthworkgroup.com/">http://darthworkgroup.com/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="microsimulation-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="collaboration-in-github.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/06-Shiny.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
